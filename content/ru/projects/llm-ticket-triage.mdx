---
title: "LLM-помощник для маршрутизации обращений"
summary: "Спроектировал безопасный NLP-пайплайн для точной маршрутизации тикетов при сохранении контроля человеком."
tags: ["NLP", "Research", "MLOps"]
stack: ["Transformers", "RAG", "FastAPI", "Postgres", "Docker", "OpenTelemetry"]
metrics: ["Macro-F1 +12%", "Время первого ответа −38%", "Доля галлюцинаций &lt;0.5% (аудит)"]
role: "Инженер по машинному обучению"
year: 2024
links:
  github: "https://github.com/your-handle/ticket-triage"
  article: "https://example.com/triage-notes"
featured: true
slug: "llm-ticket-triage"
---

## Проблема / контекст

Служба поддержки обрабатывала большой поток обращений с неоднородной разметкой и частыми краевыми случаями. Цель — **маршрутизировать тикеты в правильные очереди** и **извлекать ключевые сущности** (продукт, тариф, коды ошибок) без превращения системы в «черный ящик».

Требования:

- Высокая точность для критичных очередей (billing/security)
- Прозрачный аудит (почему тикет был направлен именно туда)
- Возможность ручной корректировки и непрерывного обучения

## Подход / пайплайн

Собрал гибридный подход:

1. **Быстрый классификатор** (дистиллированный трансформер) для типовых категорий.
2. **RAG-извлечение** структурированных полей на основе внутренних документов.
3. **Слой безопасности**: правила + пороги уверенности + обязательные цитаты.

```text
[Ticket] -> [Classifier] -> (high confidence) -> [Route]
        \-> (low confidence)  -> [RAG Extract] -> [Gated Route + Evidence]
```

## Данные

- Исторические обращения с шумной разметкой
- Небольшой «золотой» набор, разметка вместе с лидами поддержки
- Синтетические edge-кейсы для стресс-тестов

## Результаты

- **Macro-F1 +12%** после очистки и калибровки
- **Время первого ответа −38%** за счет снижения ручной маршрутизации
- **Доля галлюцинаций &lt;0.5%** (аудитная выборка) благодаря цитированию и порогам

## Заметки по реализации

Легкий confidence-gate:

```python
def route(pred_label: str, p: float, critical: set[str]) -> str:
    if pred_label in critical and p &lt; 0.92:
        return "needs-human"
    if p &lt; 0.80:
        return "needs-human"
    return pred_label
```

## Выводы

- Нельзя полагаться только на агрегированные метрики — **срезы** выявляют реальные риски.
- RAG работает лучше, когда документы аккуратно организованы и **есть владелец**.
